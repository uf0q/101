<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة برا السالفة - النسخة الأسطورية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
    <style>
        /* الخطوط والخلفية */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1f2838, #0a0e14);
            color: #f1f1f1;
            direction: rtl;
            text-align: center;
            display: flex; /* استخدام فليكس بوكس لتوسيط الحاوية */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* حاوية الهاتف */
        .mobile-container {
            width: 100%;
            max-width: 450px;
            height: 90vh;
            max-height: 900px;
            background: #151d28; /* لون خلفية داخل الإطار */
            border-radius: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow-y: auto; /* تمكين التمرير العمودي */
            overflow-x: hidden;
        }
        
        /* تصميم زر العودة الجديد */
        .back-home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.08);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #72efdd;
            text-decoration: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
            z-index: 100; /* ليبقى فوق كل الشاشات */
        }
        
        .back-home-btn:hover {
            transform: scale(1.1);
        }
        
        .back-home-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* حاويات الشاشات والواجهة */
        .screen {
            display: none;
            padding: 40px 20px;
            min-height: 100%;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            width: 100%;
            animation: fadeIn 0.8s ease-in-out;
            box-sizing: border-box; /* لضمان أن البادينغ لا يؤثر على العرض */
        }
        .active {
            display: flex;
        }
        .box {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* العناوين والفقرات */
        h1 {
            color: #72efdd;
            margin-bottom: 15px;
            font-size: 2.5em;
        }
        p {
            color: #d8f1f0;
            margin: 10px 0;
            line-height: 1.6;
        }

        /* الأزرار وحقول الإدخال */
        button, input[type="text"], select {
            font-family: 'Cairo', sans-serif;
            font-size: 1.1em;
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            margin: 10px;
            cursor: pointer;
            transition: transform 0.2s ease, background-color 0.3s ease;
            text-align: center;
        }
        button {
            background-color: #72efdd;
            color: #1f2838;
            font-weight: bold;
        }
        button:hover {
            transform: translateY(-3px);
            background-color: #5ce0c7;
        }
        input[type="text"], select {
            background-color: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        input[type="text"]::placeholder {
            color: #aaa;
            text-align: right;
        }
        
        /* شبكة الفئات */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .category-option {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .category-option:hover {
            transform: scale(1.05);
            background-color: rgba(255, 255, 255, 0.2);
        }
        .category-option i {
            font-size: 3em;
            margin-bottom: 10px;
            color: #72efdd;
        }
        .category-option span {
            font-weight: bold;
        }
        
        /* لوحة النقاط - داخل شاشة النتيجة */
        #final-scoreboard {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        #final-scoreboard h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #fff;
        }
        .score-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 1.1em;
        }
        .score-item span {
            font-weight: bold;
        }
        .score-item .player-name {
            color: #72efdd;
        }

        /* شاشة اللعب الرئيسية */
        #game-screen .box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #game-info {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            width: 100%;
        }
        #game-info p {
            font-size: 1.2em;
        }
        #timer {
            font-size: 2em;
            font-weight: bold;
            color: #ff6b6b;
            margin-top: 10px;
        }
        
        /* شاشة التصويت */
        #vote-options label {
            display: block;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #vote-options label:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        #vote-options input[type="radio"] {
            display: none;
        }
        #vote-options input[type="radio"]:checked + label {
            background-color: #72efdd;
            color: #1f2838;
        }

        /* الأنميشن */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #animation-screen {
            background-color: #1f2838;
            opacity: 0.95;
            z-index: 2000;
            transition: opacity 0.5s ease-in-out;
        }

        /* Media Queries لضبط الواجهة على الشاشات الصغيرة */
        @media (max-width: 600px) {
            body {
                font-size: 14px;
            }
            .mobile-container {
                height: 100vh;
                max-height: none;
                max-width: none;
                border-radius: 0;
                box-shadow: none;
                overflow-y: auto; /* تمكين التمرير على الجوال */
            }
            .screen {
                padding: 20px 10px;
            }
            .box {
                padding: 20px;
                width: 95%;
            }
            h1 {
                font-size: 1.8em;
            }
            p {
                font-size: 1em;
            }
            button, input[type="text"], select {
                font-size: 1em;
                padding: 10px 20px;
            }
            .category-option {
                padding: 15px;
            }
            .category-option i {
                font-size: 2.5em;
            }
            #game-info {
                padding: 15px;
            }
            #timer {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>

    <div class="mobile-container">
        <a href="index.html" class="back-home-btn">
            <i class="fas fa-home"></i>
        </a>
        
        <div id="category-screen" class="screen active">
            <div class="box">
                <h1>اختر فئة اللعب 🕹️</h1>
                <p>اختر الفئة المفضلة لبدء اللعبة. سيتوجب على الجميع معرفة الشيء باستثناء شخص واحد!</p>
                <div id="category-options" class="category-grid"></div>
            </div>
        </div>

        <div id="setup-screen" class="screen">
            <div class="box">
                <h1>إعداد اللعبة 👥</h1>
                <form id="setup-form">
                    <label for="numPlayers">عدد اللاعبين (3-6):</label>
                    <select id="numPlayers">
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                    </select>
                    <button type="submit">التالي</button>
                </form>
                <button id="back-to-category-btn">رجوع</button>
            </div>
        </div>

        <div id="names-screen" class="screen">
            <div class="box">
                <h1>أدخلوا أسماءكم ✍️</h1>
                <form id="names-form">
                    <div id="names-container"></div>
                    <button type="submit">بدء اللعبة</button>
                </form>
                <button id="back-to-setup-btn">رجوع</button>
            </div>
        </div>

        <div id="role-screen" class="screen">
            <div class="box">
                <h1>دورك الآن 🤫</h1>
                <p id="role-player-name"></p>
                <p id="role-message">أمسك الهاتف جيداً واضغط الزر لمعرفة دورك. لا تدع أحدًا يرى!</p>
                <button id="reveal-role-btn">أنا جاهز</button>
                <button id="next-role-btn" style="display:none;">التالي</button>
                <button id="back-to-names-btn">رجوع</button>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <div class="box">
                <h1>مرحلة الاستجواب 🔍</h1>
                <div id="game-info">
                    <p id="turn-info"></p>
                    <p id="timer"></p>
                </div>
                <button id="next-turn-btn">الدور التالي</button>
                <button id="go-to-vote-btn">بدء التصويت</button>
            </div>
        </div>

        <div id="vote-collecting-screen" class="screen">
            <div class="box">
                <h1 id="voting-player-name"></h1>
                <p>من هو برأيك الشخص الذي لا يعرف الشيء؟</p>
                <form id="voting-form">
                    <div id="vote-options-collect"></div>
                    <button type="submit">تأكيد التصويت</button>
                </form>
            </div>
        </div>

        <div id="result-screen" class="screen">
            <div class="box">
                <h1>نتيجة الجولة 🏁</h1>
                <p id="result-message"></p>
                <div id="final-scoreboard">
                    <h3>🏆 لوحة النقاط</h3>
                    <div id="score-content"></div>
                </div>
                <button class="next-round-btn" id="next-round-btn">جولة جديدة</button>
                <button id="restart-btn">إعادة ضبط اللعبة</button>
            </div>
        </div>

        <div id="animation-screen" class="screen" style="display: none;">
            <div class="box" style="padding: 50px;">
                <p id="animation-content" style="font-size: 2em; font-weight: bold;"></p>
            </div>
        </div>
    </div>
    
    <audio id="beep-sound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto"></audio>
    <audio id="win-sound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" preload="auto"></audio>
    <audio id="lose-sound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" preload="auto"></audio>

    <script>
        // المتغيرات الأساسية
        let numPlayers, chosenItem, liarIndex;
        let players = [];
        let scoreboard = {};
        let round = 1;
        let roleIndex = 0;
        let gameTimer;
        let timeRemaining = 120;
        let currentTurnIndex = 0;
        let votes = {};
        let votingPlayerIndex = 0;

        // الفئات والعناصر المحدثة
        const categories = {
            "أفلام": [
                "إنترستيلر", "الجوكر", "باراسايت", "سيكاريو", "فايت كلوب", "ماد ماكس: فيوري رود", "ذا دارك نايت",
                "المتعهدون", "طارد الأرواح الشريرة", "العراب", "البريق", "رحلة إلى كوكب الأقمار", "العودة إلى المستقبل", "المصفوفة",
                "حرب النجوم: الأمل الجديد", "إنديانا جونز: غزاة الفلك المفقود", "سيد الخواتم: رفقة الخاتم", "جومانجي", "حديقة الديناصورات",
                "تايتانيك", "فورست غامب", "الناجي الأخير", "قصة لعبة", "الأسد الملك", "تيتو", "الجزيرة", "كراكرز", "الفيل الأزرق",
                "أرض الخوف", "الخلية", "الكنز", "الفيل الأزرق", "تومب رايدر", "جون ويك", "المنتقمون: نهاية اللعبة", "المجال الحيوي",
                "هاري بوتر وحجر الفيلسوف", "سبايدرمان: لا عودة للوطن", "جوكر", "لا لا لاند", "بلاك بانثر", "انتقام", "يوم الاستقلال",
                "ذا مارشان", "جودزيلا", "كوكو", "رالف المدمر", "زوتوبيا", "العصر الجليدي", "البحث عن نيمو", "كوكب الكنز", "شريك", "السيارات",
                "فروزن", "الجميلة والوحش", "مولان", "علاء الدين", "ليون المحترف", "الجمعة الثالثة عشر", "سايكو", "كوكب القرود", "الملك آرثر"
            ],
            "أماكن": [
                "باريس", "الأهرامات", "برج خليفة", "سور الصين العظيم", "الكولوسيوم", "مكة المكرمة", "سديم أوريون", "غراند كانيون",
                "متحف اللوفر", "جبال الألب", "شلالات نياجرا", "جبل فوجي", "تاج محل", "ماتشو بيتشو", "البندقية", "مدينة البتراء",
                "جبل إيفرست", "الغابة السوداء", "الشفق القطبي", "حاجز الشعب المرجانية العظيم", "الكعبة المشرفة", "المسجد الأقصى", "حرم الإمام الرضا",
                "متحف الملكة", "صخرة الفطر", "جبل طارق", "المتحف المصري", "جزر المالديف", "برج إيفل", "تمثال الحرية", "بيغ بن",
                "قصر الحمراء", "جزيرة سانتوريني", "جبال الأطلس", "بحر العرب", "صحراء الربع الخالي", "نهر النيل", "البحر الميت",
                "نهر الأمازون", "صحراء موهافي", "فوهة تشيكشولوب", "نهر دجلة", "نهر الفرات", "برج بيزا المائل", "مدينة روما",
                "ميدان التحرير", "صحراء سيناء", "مدينة تدمر", "هونغ كونغ", "قناة بنما", "قناة السويس", "مدينة طوكيو", "مدينة نيويورك",
                "مدينة لندن", "مدينة الرياض", "مدينة جدة", "جبل أحد", "غابة الأمازون", "البحر الأبيض المتوسط"
            ],
            "شخصيات تاريخية": [
                "أحمد بن ماجد", "ابن بطوطة", "ابن سينا", "الحلاج", "صلاح الدين الأيوبي", "عمر المختار", "جوليوس قيصر",
                "نيلسون مانديلا", "مارتن لوثر كينج", "أبو بكر الصديق", "عمر بن الخطاب", "عثمان بن عفان", "علي بن أبي طالب",
                "ابن خلدون", "المتنبي", "الخوارزمي", "ليوناردو دافنشي", "ألبرت أينشتاين", "توماس إديسون", "فنسنت فان جوخ",
                "بابلو بيكاسو", "سقراط", "أفلاطون", "أرسطو", "أبو العلاء المعري", "المهاتما غاندي", "الإسكندر الأكبر",
                "جان دارك", "الملكة إليزابيث الأولى", "يوليوس قيصر", "نابليون بونابرت", "وليم شكسبير", "كليوباترا",
                "كولومبوس", "تشي جيفارا", "أدولف هتلر", "ونستون تشرشل", "موسوليني", "فلاديمير لينين", "فيدل كاسترو",
                "ماو تسي تونغ", "جواهر لال نهرو", "صدام حسين", "ياسر عرفات", "جمال عبد الناصر", "حافظ الأسد", "الملك فيصل",
                "الملك عبد العزيز", "الملك خالد", "الملك فهد", "الملك عبد الله", "الملك سلمان", "الأمير محمد بن سلمان",
                "أبو هريرة", "أبو ذر الغفاري", "عمر بن عبد العزيز", "هارون الرشيد", "المأمون", "الرشيد", "أبو جعفر المنصور"
            ],
            "أكلات عالمية": [
                "بيتزا", "سوشي", "تاكو", "باستا", "برجر", "دجاج تندوري", "فلافل", "كشري", "المندي", "المكبوس",
                "المحشي", "الشاورما", "الكبسة", "الفول المدمس", "الكفتة", "المنسف", "الفريكة", "المسخن", "البشاميل",
                "اللازانيا", "كريب", "بان كيك", "وافل", "دونات", "السينابون", "كوكيز", "براوني", "الشوربة",
                "الشاورما", "الهمبرغر", "النقانق", "البيتزا", "الفاهيتا", "الناشوز", "الجولاش", "الفطائر", "الكرواسون",
                "الكسكسي", "البايلا", "الباغيت", "الجريش", "المعكرونة", "الفريكة", "المندي", "المسقعة", "السوفلاكي",
                "البرياني", "الشوربة", "الباغيت", "الكسكسي", "السمبوسة", "الكبسة", "الكسكسي", "البيتزا", "البرجر",
                "السوشي", "الباستا", "الدجاج", "اللحم", "الأسماك", "الخضار", "الفواكه", "الخبز", "المقبلات",
                "الخضار", "الأسماك", "اللحم", "الدجاج", "البيض", "الجبن", "اللبن", "العصائر", "الحليب"
            ],
            "رياضة": [
                "محمد علي", "مايكل جوردن", "دييغو مارادونا", "ليبرون جيمس", "مايك تايسون", "رافائيل نادال", "روجيه فيدرر",
                "ليونيل ميسي", "كريستيانو رونالدو", "كيليان مبابي", "نيمار", "سيرينا ويليامز", "تايجر وودز", "بيليه",
                "زين الدين زيدان", "عمر السومة", "ياسر القحطاني", "ماجد عبد الله", "سامي الجابر", "نواف العابد", "سالم الدوسري",
                "يوسف الثنيان", "محمد نور", "يوسف الشريف", "عمر الشريف", "عبد المجيد عبد الله", "خالد عبد الرحمن",
                "مايكل شوماخر", "لويس هاميلتون", "سيباستيان فيتل", "خوان مانويل فانجيو", "آيرتون سينا", "فيرناندو ألونسو",
                "توم برادي", "ليبرون جيمس", "كوبي براينت", "شاكيل أونيل", "كريم عبد الجبار", "بيل راسل", "ماجيك جونسون",
                "مايكل فيلبس", "أوساين بولت", "دييجو مارادونا", "باولو مالديني", "فرانشيسكو توتي", "ديديه دروجبا",
                "ساديو ماني", "محمد صلاح", "رياض محرز", "نغولو كانتي", "أبو تريكة", "محمد أبو تريكة", "أحمد حسن",
                "عمرو زكي", "حسام حسن", "مصطفى يونس", "محمود الخطيب", "حسام عاشور", "سعد سمير", "أحمد فتحي"
            ],
            "ألعاب فيديو": [
                "ماينكرافت", "جراند ثيفت أوتو", "فيفا", "فورتنايت", "كول أوف ديوتي", "ريد ديد ريدمبشن", "أساسنز كريد",
                "ليج أوف ليجيندز", "دوتا 2", "ببجي", "أوفرواتش", "سوبر ماريو", "زيلدا", "بوكيمون", "فاينل فانتسي",
                "ميتال جير سوليد", "سايلنت هيل", "ريزيدنت إيفل", "جود أوف وار", "ذا لاست أوف أس", "هيلو", "جيرز أوف وار",
                "أنشارتد", "باتمان: أركام أسايلم", "سبايدرمان", "سوبر سماش برذرز", "أنيمال كروسينج", "ستارديو فالي",
                "تتريس", "باك مان", "سنيك", "بومبر مان", "ستريت فايتر", "مورتال كومبات", "تكن", "نينجا غايدن",
                "أوفرواتش", "وورلد أوف ووركرافت", "ديابلو", "بورتال", "نيد فور سبيد", "جران توريزمو", "كراش بانديكوت",
                "سبايرو", "رايمان", "جنرالز", "كوماندوز", "برنس أوف بيرشيا", "فالنتاين", "نيد فور سبيد", "الفانتازيا",
                "جراند ثيفت أوتو 5", "ريد ديد ريدمبشن 2", "سيبيربانك 2077", "ويتشر 3: وايلد هانت", "جود أوف وار",
                "هورايزون زيرو داون", "أساسنز كريد أوديسي", "أساسنز كريد فالهالا", "فاينل فانتسي 7 ريميك", "كول أوف ديوتي وورزون",
                "فالورانت", "ليج أوف ليجيندز: وايلد ريفت", "كرافتون", "فورتنايت", "ببجي موبايل", "ماينكرافت: دنجنز"
            ],
            "حيوانات": [
                "الأسد", "النمر", "الفيل", "الزرافة", "النعامة", "الكنغر", "الباندا", "الفهد", "الذئب", "الثعلب",
                "الكلب", "القط", "الحصان", "الحمار", "البقرة", "الجمل", "الماعز", "الخروف", "الدجاجة", "البط", "الإوزة",
                "الخنزير", "الأسد", "النمر", "الفهد", "الزرافة", "الحصان", "الحمار", "البغل", "القرد", "الدب", "الضبع",
                "الذئب", "الخفاش", "التمساح", "الثعبان", "القرش", "الحوت", "الدلفين", "البطريق", "الدب القطبي", "الراكون",
                "السمك", "الطيور", "الزواحف", "الضفدع", "الضفدع", "الضفدع", "السمك", "الطيور", "الزواحف", "الضفدع",
                "القرش", "الحوت", "الدلفين", "البطريق", "الدب القطبي", "الراكون", "النسر", "الصقر", "العقاب", "الغراب",
                "الحمامة", "القطرس", "اللقلق", "البومة", "البومة", "البومة", "البومة", "البومة", "البومة"
            ],
            "انمي": [
                "هجوم العمالقة", "ناروتو", "ون بيس", "دراغون بول", "ديمون سلاير", "جوجوتسو كايسن", "ماي هيرو أكاديمي",
                "ديث نوت", "فول ميتال ألكيميست", "هنتر X هنتر", "بيرسيرك", "بلايتش", "الكونغو", "الكونغو", "الكونغو",
                "كونان", "ون بنش مان", "كود جياس", "كيميتسو نو يايبا", "هجوم العمالقة", "ناروتو شيبودن", "ناروتو",
                "ون بيس", "دراغون بول زد", "دراغون بول سوبر", "ديمون سلاير: قطار اللانهاية", "جوجوتسو كايسن 0", "ماي هيرو أكاديمي: وورلد هيروز ميشن",
                "ديث نوت: ل", "فول ميتال ألكيميست: براذرهود", "هنتر X هنتر", "بيرسيرك", "بلايتش", "كونان", "ون بنش مان",
                "كود جياس", "كيميتسو نو يايبا", "هجوم العمالقة", "ناروتو شيبودن", "ناروتو", "ون بيس", "دراغون بول زد",
                "دراغون بول سوبر", "ديمون سلاير: قطار اللانهاية", "جوجوتسو كايسن 0", "ماي هيرو أكاديمي: وورلد هيروز ميشن",
                "طوكيو غول", "أكاديمية الساحرات الصغيرات", "ون بنش مان", "كود جياس", "هجوم العمالقة", "ناروتو", "ون بيس",
                "بليتش", "هنتر x هنتر", "فول ميتال ألكيميست", "ديث نوت", "هجوم العمالقة: الموسم الأول",
                "هجوم العمالقة: الموسم الثاني", "هجوم العمالقة: الموسم الثالث", "هجوم العمالقة: الموسم الرابع"
            ]
        };

        const categoryIcons = {
            "أفلام": "fa-film",
            "أماكن": "fa-landmark",
            "شخصيات تاريخية": "fa-scroll",
            "أكلات عالمية": "fa-pizza-slice",
            "رياضة": "fa-basketball-ball",
            "ألعاب فيديو": "fa-gamepad",
            "حيوانات": "fa-paw",
            "انمي": "fa-fan"
        };
        
        // المؤثرات الصوتية
        const beepSound = document.getElementById("beep-sound");
        const winSound = document.getElementById("win-sound");
        const loseSound = document.getElementById("lose-sound");

        function playSound(sound) {
            sound.play();
        }

        // وظائف أساسية
        function switchScreen(fromId, toId) {
            const fromScreen = document.getElementById(fromId);
            const toScreen = document.getElementById(toId);
            if (fromScreen) fromScreen.classList.remove("active");
            if (toScreen) toScreen.classList.add("active");
        }

        function updateScoreboard() {
            let boardContent = document.getElementById("score-content");
            boardContent.innerHTML = "";
            let sortedPlayers = Object.keys(scoreboard).sort((a, b) => scoreboard[b] - scoreboard[a]);
            sortedPlayers.forEach(name => {
                let scoreItem = document.createElement("div");
                scoreItem.classList.add("score-item");
                let playerName = document.createElement("span");
                playerName.classList.add("player-name");
                playerName.innerText = name;
                let playerScore = document.createElement("span");
                playerScore.innerText = scoreboard[name];
                scoreItem.appendChild(playerName);
                scoreItem.appendChild(playerScore);
                boardContent.appendChild(scoreItem);
            });
        }
        
        // شاشة اختيار الفئة
        function generateCategoryOptions() {
            const container = document.getElementById("category-options");
            container.innerHTML = "";
            for (let cat in categories) {
                let div = document.createElement("div");
                div.classList.add("category-option");
                div.setAttribute("data-category", cat);
                let icon = document.createElement("i");
                icon.classList.add("fas", categoryIcons[cat]);
                div.appendChild(icon);
                let span = document.createElement("span");
                span.innerText = cat;
                div.appendChild(span);
                div.addEventListener("click", function() {
                    let items = categories[cat];
                    chosenItem = items[Math.floor(Math.random() * items.length)];
                    switchScreen("category-screen", "setup-screen");
                });
                container.appendChild(div);
            }
        }
        generateCategoryOptions();
        
        // شاشة إعداد اللاعبين
        document.getElementById("setup-form").addEventListener("submit", function(e) {
            e.preventDefault();
            numPlayers = parseInt(document.getElementById("numPlayers").value);
            switchScreen("setup-screen", "names-screen");
            generateNameInputs();
        });

        // زر الرجوع من شاشة إعداد اللاعبين
        document.getElementById("back-to-category-btn").addEventListener("click", function() {
            if (confirm("هل أنت متأكد من العودة؟ سيتم مسح الإعدادات الحالية.")) {
                switchScreen("setup-screen", "category-screen");
            }
        });
        
        function generateNameInputs() {
            const container = document.getElementById("names-container");
            container.innerHTML = "";
            for(let i = 0; i < numPlayers; i++){
                let input = document.createElement("input");
                input.type = "text";
                input.required = true;
                input.placeholder = "اسم اللاعب " + (i + 1);
                input.id = "playerName" + i;
                container.appendChild(input);
            }
        }
        
        // شاشة الأسماء
        document.getElementById("names-form").addEventListener("submit", function(e) {
            e.preventDefault();
            players = [];
            for(let i = 0; i < numPlayers; i++){
                let name = document.getElementById("playerName" + i).value.trim();
                if(name === ""){
                    alert("الرجاء إدخال جميع أسماء اللاعبين.");
                    return;
                }
                players.push(name);
                if (scoreboard[name] === undefined) {
                    scoreboard[name] = 0;
                }
            }
            liarIndex = Math.floor(Math.random() * numPlayers);
            switchScreen("names-screen", "role-screen");
            roleIndex = 0;
            updateRoleScreen();
        });

        // زر الرجوع من شاشة إدخال الأسماء
        document.getElementById("back-to-setup-btn").addEventListener("click", function() {
            if (confirm("هل أنت متأكد من العودة؟ سيتم مسح الأسماء التي أدخلتها.")) {
                switchScreen("names-screen", "setup-screen");
            }
        });
        
        // شاشة عرض الدور
        function updateRoleScreen() {
            if(roleIndex >= players.length) {
                switchScreen("role-screen", "game-screen");
                startGameTimer();
                return;
            }
            document.getElementById("role-player-name").innerText = players[roleIndex];
            document.getElementById("role-message").innerHTML = "أمسك الهاتف جيداً واضغط الزر لمعرفة دورك. لا تدع أحدًا يرى!";
            document.getElementById("reveal-role-btn").style.display = "inline-block";
            document.getElementById("next-role-btn").style.display = "none";
        }
        
        document.getElementById("reveal-role-btn").addEventListener("click", function() {
            let messageElem = document.getElementById("role-message");
            if(roleIndex === liarIndex) {
                messageElem.innerHTML = `أنت <span style="color: #ff6b6b; font-weight: bold;">"برا السالفة"</span>! <br> دورك هو الخداع والمراوغة.`;
            } else {
                messageElem.innerHTML = `الشيء هو: <span style="color: #72efdd; font-weight: bold;">${chosenItem}</span>`;
            }
            document.getElementById("reveal-role-btn").style.display = "none";
            document.getElementById("next-role-btn").style.display = "inline-block";
        });
        
        document.getElementById("next-role-btn").addEventListener("click", function() {
            roleIndex++;
            updateRoleScreen();
        });

        // زر الرجوع من شاشة عرض الدور
        document.getElementById("back-to-names-btn").addEventListener("click", function() {
            if (confirm("هل أنت متأكد من العودة؟ سيتم إعادة تعيين الأدوار.")) {
                switchScreen("role-screen", "names-screen");
            }
        });
        
        // مرحلة الاستجواب
        function startGameTimer() {
            timeRemaining = 120;
            currentTurnIndex = 0;
            document.getElementById("go-to-vote-btn").style.display = "block";
            document.getElementById("next-turn-btn").style.display = "inline-block";
            updateTurnInfo();
            gameTimer = setInterval(() => {
                timeRemaining--;
                let minutes = Math.floor(timeRemaining / 60);
                let seconds = timeRemaining % 60;
                document.getElementById("timer").innerText = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                if (timeRemaining <= 10 && timeRemaining > 0) {
                    playSound(beepSound);
                }
                if (timeRemaining <= 0) {
                    clearInterval(gameTimer);
                    endGameInterrogation();
                }
            }, 1000);
        }
        
        function updateTurnInfo() {
            const askerIndex = currentTurnIndex % players.length;
            const targetIndex = (currentTurnIndex + 1) % players.length;
            document.getElementById("turn-info").innerText = `دور السؤال: ${players[askerIndex]} يسأل ${players[targetIndex]}.`;
        }
        
        document.getElementById("next-turn-btn").addEventListener("click", function() {
            currentTurnIndex++;
            updateTurnInfo();
        });
        
        function endGameInterrogation() {
            document.getElementById("next-turn-btn").style.display = "none";
            document.getElementById("go-to-vote-btn").style.display = "block";
            document.getElementById("turn-info").innerText = "انتهى وقت الاستجواب! اضغطوا على زر التصويت.";
        }
        
        document.getElementById("go-to-vote-btn").addEventListener("click", function() {
            clearInterval(gameTimer);
            switchScreen("game-screen", "vote-collecting-screen");
            startVotingProcess();
        });
        
        // شاشة التصويت
        function startVotingProcess() {
            votingPlayerIndex = 0;
            votes = {};
            displayVotingScreen();
        }

        function displayVotingScreen() {
            if (votingPlayerIndex >= players.length) {
                tallyVotes();
                return;
            }

            switchScreen("vote-collecting-screen", "vote-collecting-screen");
            document.getElementById("voting-player-name").innerText = `دور التصويت: ${players[votingPlayerIndex]}`;
            
            let voteDiv = document.getElementById("vote-options-collect");
            voteDiv.innerHTML = "";
            players.forEach((player, index) => {
                if (index !== votingPlayerIndex) {
                    let label = document.createElement("label");
                    label.innerHTML = `<input type="radio" name="vote" value="${index}"> ${player}`;
                    voteDiv.appendChild(label);
                }
            });
        }

        document.getElementById("voting-form").addEventListener("submit", function(e) {
            e.preventDefault();
            let voteInput = document.querySelector('#vote-options-collect input[name="vote"]:checked');
            if(!voteInput) {
                alert("الرجاء اختيار لاعب للتصويت.");
                return;
            }
            let votedIndex = parseInt(voteInput.value);
            let votedPlayerName = players[votedIndex];
            votes[votedPlayerName] = (votes[votedPlayerName] || 0) + 1;

            votingPlayerIndex++;
            displayVotingScreen();
        });

        function tallyVotes() {
            let maxVotes = 0;
            let mostVotedPlayer = null;
            let tie = false;
            
            for (const player in votes) {
                if (votes[player] > maxVotes) {
                    maxVotes = votes[player];
                    mostVotedPlayer = player;
                    tie = false;
                } else if (votes[player] === maxVotes) {
                    tie = true;
                }
            }

            let resultMsg = "";
            if (mostVotedPlayer === players[liarIndex] && !tie) {
                resultMsg = `تهانينا! لقد كشفتم اللاعب <span style="color:#ff6b6b; font-weight: bold;">${players[liarIndex]}</span> الذي كان "برا السالفة"!`;
                players.forEach((player, idx) => {
                    if(idx !== liarIndex) scoreboard[player] += 1;
                });
                playSound(winSound);
            } else {
                resultMsg = `للأسف! فشلتم في كشفه. اللاعب الذي كان "برا السالفة" هو <span style="color:#ff6b6b; font-weight: bold;">${players[liarIndex]}</span>.`;
                scoreboard[players[liarIndex]] += 2;
                playSound(loseSound);
            }

            document.getElementById("result-message").innerHTML = resultMsg;
            updateScoreboard();
            switchScreen("vote-collecting-screen", "result-screen");
            playAnimation();
        }
        
        // شاشة النتيجة
        document.getElementById("next-round-btn").addEventListener("click", function() {
            round++;
            liarIndex = Math.floor(Math.random() * numPlayers);
            let categoriesKeys = Object.keys(categories);
            let randomCategory = categoriesKeys[Math.floor(Math.random() * categoriesKeys.length)];
            chosenItem = categories[randomCategory][Math.floor(Math.random() * categories[randomCategory].length)];
            
            roleIndex = 0;
            switchScreen("result-screen", "role-screen");
            updateRoleScreen();
        });
        
        document.getElementById("restart-btn").addEventListener("click", function() {
            location.reload();
        });
        
        // الأنميشن
        function playAnimation() {
            let animScreen = document.getElementById("animation-screen");
            let content = document.getElementById("animation-content");
            animScreen.style.display = "flex";
            content.innerText = "كشف الهوية... 🕵️‍♂️";
            setTimeout(() => {
                content.innerText = `اللاعب ${players[liarIndex]} هو الذي لا يعرف الشيء!`;
                setTimeout(() => {
                    animScreen.style.display = "none";
                }, 3000);
            }, 3000);
        }
    </script>
</body>
</html>
